<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Queries and Extracts Images from Extensible Neuroimaging Archive Toolkit Public/Private Datasets • Rxnat</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="bootstrap-toc.css">
<script src="bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="pkgdown.css" rel="stylesheet">
<script src="pkgdown.js"></script><meta property="og:title" content="Queries and Extracts Images from Extensible Neuroimaging Archive Toolkit Public/Private Datasets">
<meta property="og:description" content="Allows communication with Extensible Neuroimaging Archive Toolkit &lt;https://www.xnat.org&gt;. 
  Rxnat is using the XNAT REST API to perform data queries and download images.">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-home">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="index.html">Rxnat</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">1.0.9</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="index.html">
    <span class="fas fa fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="articles/rxnat.html">Using the Rxnat Package</a>
    </li>
  </ul>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/adigherman/Rxnat/">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="contents col-md-9">


<div id="rxnat-query-and-retrieves-neuroimaging-sets-from-xnat-projects" class="section level1">
<div class="page-header"><h1 class="hasAnchor">
<a href="#rxnat-query-and-retrieves-neuroimaging-sets-from-xnat-projects" class="anchor"></a>Rxnat: Query and retrieves neuroimaging sets from XNAT projects</h1></div>
<div id="what-is-xnat" class="section level2">
<h2 class="hasAnchor">
<a href="#what-is-xnat" class="anchor"></a>What is XNAT?</h2>
<p>XNAT is an open source imaging informatics platform developed by the Neuroinformatics Research Group at Washington University. XNAT was originally developed in the Buckner Lab at Washington University, now at Harvard University. It facilitates common management, productivity, and quality assurance tasks for imaging and associated data. Thanks to its extensibility, XNAT can be used to support a wide range of imaging-based projects.</p>
</div>
<div id="who-is-using-xnat" class="section level2">
<h2 class="hasAnchor">
<a href="#who-is-using-xnat" class="anchor"></a>Who is using XNAT?</h2>
<p>There are several projects that currently use XNAT to manage a vast number of datasets.</p>
<ul>
<li>
<a href="https://nitrc.org">NITRC</a> - Neuroimaging Informatics Tools and Resources Clearinghouse is currently a free one-stop-shop collaboratory for science researchers that need resources such as neuroimaging analysis software, publicly available data sets, or computing power.</li>
<li>
<a href="https://db.humanconnectome.org/">ConnectomeDB</a> - The Human Connectome Project (HCP) is a project to construct a map of the complete structural and functional neural connections in vivo within and across individuals.</li>
<li>
<a href="https://central.xnat.org">XNAT Central</a> - XNAT Central is a database for sharing neuroimaging and related data with select collaborators or the general community.</li>
</ul>
<p>For a more complete list of XNAT implementations around the world you can click <a href="https://www.xnat.org/about/xnat-implementations.php">here</a>.</p>
</div>
<div id="installing-the-rxnat-package" class="section level2">
<h2 class="hasAnchor">
<a href="#installing-the-rxnat-package" class="anchor"></a>Installing the Rxnat package</h2>
<p>You can install <code>Rxnat</code> from github with:</p>
<pre class="{r}"><code><a href="https://remotes.r-lib.org/reference/install_github.html"># install.packages("remotes")
remotes::install_github("adigherman/Rxnat")</a></code></pre>
</div>
<div id="accessing-xnat-data" class="section level2">
<h2 class="hasAnchor">
<a href="#accessing-xnat-data" class="anchor"></a>Accessing XNAT Data</h2>
<div id="how-to-get-a-usernamepassword-for-a-xnat-project" class="section level3">
<h3 class="hasAnchor">
<a href="#how-to-get-a-usernamepassword-for-a-xnat-project" class="anchor"></a>How to get a username/password for a XNAT project</h3>
<p>XNAT projects can be public or private. In order to access a private repository a set of credentials are required. To obtain a user name and password combo you will need to visit:</p>
<ul>
<li>HCP (Human Connectome Project) - <a href="https://db.humanconnectome.org">new account request</a> and click on the Register button</li>
<li>NITRC - <a href="https://www.nitrc.org/account/register.php">new account request</a>. Some of the NITRC hosted projects will require additional access requests but this can be easily requested using the NITRC web interface for each project.</li>
<li>XNAT Central - this is mostly public, but you can also perform a <a href="https://central.xnat.org/app/template/Register.vm">new account request</a> if any of the projects require it.</li>
</ul>
</div>
<div id="establishing-a-xnat-connection-with-the-rxnat-package" class="section level3">
<h3 class="hasAnchor">
<a href="#establishing-a-xnat-connection-with-the-rxnat-package" class="anchor"></a>Establishing a XNAT connection with the <code>Rxnat</code> package</h3>
<p>The <code>Rxnat</code> package will accept credentials provided in the function call or read from the system environment.</p>
<div id="function-parameters" class="section level4">
<h4 class="hasAnchor">
<a href="#function-parameters" class="anchor"></a>Function parameters</h4>
<p>To establish a connection using the credentials as function parameters we can call the <code>xnat_connect</code> function:</p>
<pre class="{r}"><code>nitrc &lt;- xnat_connect('https://nitrc.org/ir', username='XXXX', password='YYYY', xnat_name=NULL)</code></pre>
</div>
<div id="setting-up-system-environment-variables" class="section level4">
<h4 class="hasAnchor">
<a href="#setting-up-system-environment-variables" class="anchor"></a>Setting up system environment variables</h4>
<p>To use system environment variables we need to add them to the <code>.Renviron</code> file located in the user’s home folder. Use <code><a href="https://rdrr.io/r/base/Sys.getenv.html">Sys.getenv("HOME")</a></code> to get the path (for unix/osx users the location can be easily accessed with ~, eg. <code>vi ~/.Renviron</code>). The <code>Rxnat</code> package will be able to automatically read / use a system environment variable provided the following format is used: <code>XXXX_RXNAT_USER</code> and <code>XXXX_RXNAT_PASS</code>. <code>XXXX</code> is provided as an argument when an XNAT connection is initiated.</p>
<p>As an example <code>NITRC</code> is used as argument and the system environment variables names should be <code>NITRC_RXNAT_USER</code>, and <code>NITRC_RXNAT_PASS</code>.</p>
<pre class="{r}"><code>nitrc &lt;- xnat_connect('https://nitrc.org/ir', xnat_name='NITRC')</code></pre>
</div>
</div>
</div>
<div id="get-list-of-available-xnat-projects" class="section level2">
<h2 class="hasAnchor">
<a href="#get-list-of-available-xnat-projects" class="anchor"></a>Get list of available XNAT projects</h2>
<p>Once a connection is established using the <code>xnat_connect</code> function a list of available projects can be easily retrieved by using the class internal function <code>projects</code>:</p>
<pre class="{r}"><code>hcp &lt;-xnat_connect('https://db.humanconnectome.org', xnat_name = "hcp")
hcp_projects &lt;- hcp$projects()
head(hcp_projects[c('id','name')])
            id                                        name
1 CCF_DMCC_STG                        DMCC Staging Project
2     HCP_1200            WU-Minn HCP Data - 1200 Subjects
3      HCP_500 WU-Minn HCP Data &amp;#150; 500 Subjects + MEG2
4  HCP_500_RST      HCP 500 Subject + MEG2 Restricted Data
5      HCP_900        WU-Minn HCP Data - 900 Subjects + 7T
6    HCP_Coded                                   HCP_Coded</code></pre>
</div>
<div id="retrieve-a-list-with-all-accessible-subjects" class="section level2">
<h2 class="hasAnchor">
<a href="#retrieve-a-list-with-all-accessible-subjects" class="anchor"></a>Retrieve a list with all accessible subjects</h2>
<p>A full list of subjects for each XNAT connection can be retrieved using the <code>subjects</code> function:</p>
<pre class="{r}"><code>hcp_subjects &lt;- hcp$subjects()
head(hcp_subjects)
       project                  ID  label gender handedness yob education ses group race ethnicity
1 HCP_Subjects ConnectomeDB_S02177 100004      M         NA  NA        NA  NA    NA   NA        NA
2 HCP_Subjects ConnectomeDB_S01982 100206      M         NA  NA        NA  NA    NA   NA        NA
3 HCP_Subjects ConnectomeDB_S00230 100307      F         NA  NA        NA  NA    NA   NA        NA
4 HCP_Subjects ConnectomeDB_S00381 100408      M         NA  NA        NA  NA    NA   NA        NA
5 HCP_Subjects ConnectomeDB_S01590 100610      M         NA  NA        NA  NA    NA   NA        NA
6 HCP_Subjects ConnectomeDB_S00551 101006      F         NA  NA        NA  NA    NA   NA        NA</code></pre>
</div>
<div id="get-full-list-of-experiments" class="section level2">
<h2 class="hasAnchor">
<a href="#get-full-list-of-experiments" class="anchor"></a>Get full list of experiments</h2>
<p>To obtain a full list of experiments the <code>experiments</code> function will be used:</p>
<pre class="{r}"><code>hcp_experiments &lt;- hcp$experiments()
head(hcp_experiments)
       project subject                  ID                type      label age
1 HCP_Subjects  100206 ConnectomeDB_E13304  xnat:mrSessionData  100206_3T  26
2 HCP_Subjects  100307 ConnectomeDB_E03657  xnat:mrSessionData  100307_3T  26
3 HCP_Subjects  100307 ConnectomeDB_E10373 xnat:megSessionData 100307_MEG  NA
4 HCP_Subjects  100408 ConnectomeDB_E03658  xnat:mrSessionData  100408_3T  31
5 HCP_Subjects  100610 ConnectomeDB_E11186  xnat:mrSessionData  100610_3T  26
6 HCP_Subjects  100610 ConnectomeDB_E24170  xnat:mrSessionData  100610_7T  26</code></pre>
</div>
<div id="get-the-complete-list-of-resources-for-a-specific-experiment" class="section level2">
<h2 class="hasAnchor">
<a href="#get-the-complete-list-of-resources-for-a-specific-experiment" class="anchor"></a>Get the complete list of resources for a specific experiment</h2>
<p>The scan resources for an experiment can be retrieved using the <code>get_xnat_experiment_resources</code> function:</p>
<pre class="{r}"><code>ConnectomeDB_E13304_resources &lt;- hcp$get_xnat_experiment_resources('ConnectomeDB_E13304')
head(ConnectomeDB_E13304_resources[c('Name','URI')])
                                 Name                                                                                                        URI
1            100206_3T_BIAS_BC.nii.gz            /data/experiments/ConnectomeDB_E13304/scans/101/resources/274961/files/100206_3T_BIAS_BC.nii.gz
2          100206_3T_BIAS_32CH.nii.gz          /data/experiments/ConnectomeDB_E13304/scans/102/resources/274962/files/100206_3T_BIAS_32CH.nii.gz
3           100206_3T_T1w_MPR1.nii.gz           /data/experiments/ConnectomeDB_E13304/scans/103/resources/274963/files/100206_3T_T1w_MPR1.nii.gz
4           100206_3T_T2w_SPC1.nii.gz           /data/experiments/ConnectomeDB_E13304/scans/106/resources/274964/files/100206_3T_T2w_SPC1.nii.gz
5 100206_3T_FieldMap_Magnitude.nii.gz /data/experiments/ConnectomeDB_E13304/scans/107/resources/274965/files/100206_3T_FieldMap_Magnitude.nii.gz
6     100206_3T_FieldMap_Phase.nii.gz     /data/experiments/ConnectomeDB_E13304/scans/108/resources/274966/files/100206_3T_FieldMap_Phase.nii.gz</code></pre>
</div>
<div id="query-the-xnat-projects-for-matching-entries" class="section level2">
<h2 class="hasAnchor">
<a href="#query-the-xnat-projects-for-matching-entries" class="anchor"></a>Query the XNAT projects for matching entries</h2>
<p>If you are interested just in a subset of subjects/experiments that match a certain criteria you can use the <code>query_scan_resources</code> function. Accepted query parameters are:</p>
<ul>
<li>subject_ID - subject ID identifier</li>
<li>project - the project ID</li>
<li>age - subject’s age</li>
<li>experiment_ID - experiment ID identifier</li>
<li>type - type of image scan</li>
<li>TR - repetition time</li>
<li>TE - echo time</li>
<li>TI - inversion time</li>
<li>flip - flip status</li>
<li>voxel_res - overall image voxel resolution</li>
<li>voxel_res_X - voxel X resolution</li>
<li>voxel_res_Y - voxel Y resolution</li>
<li>voxel_res_Z - voxel Z resolution</li>
<li>orientation - image orientation</li>
</ul>
<p>To retrieve a list of all subject IDs and associated experiment IDs we can use the <code>query_scan_resources</code> function. In the example below, we are querying the HCP XNAT database for all subjects belonging the the HCP_500 project with scans taken at age 26.</p>
<pre class="{r}"><code>hcp_500_age_26 &lt;- query_scan_resources(hcp,age='26', project='HCP_500')
head(hcp_500_age_26[c("subject_ID","experiment_ID", "Project", "Age")])
           subject_ID       experiment_ID Project Age
1 ConnectomeDB_S00230 ConnectomeDB_E03657 HCP_500  26
2 ConnectomeDB_S00231 ConnectomeDB_E03664 HCP_500  26
3 ConnectomeDB_S00234 ConnectomeDB_E03684 HCP_500  26
4 ConnectomeDB_S00235 ConnectomeDB_E03690 HCP_500  26
5 ConnectomeDB_S00236 ConnectomeDB_E03694 HCP_500  26
6 ConnectomeDB_S00237 ConnectomeDB_E03988 HCP_500  26</code></pre>
</div>
<div id="getting-data-download-a-single-scan-imageresource-file" class="section level2">
<h2 class="hasAnchor">
<a href="#getting-data-download-a-single-scan-imageresource-file" class="anchor"></a>Getting Data: Download a single scan image/resource file</h2>
<p>To download a single file we will use the <code>download_file</code> function. Using the first <code>experiment_ID</code> from the above example, we will get all scan resources associated with it first.</p>
<pre class="{r}"><code>scan_resources &lt;- get_scan_resources(hcp,'ConnectomeDB_E03657')
scan_resources[1,"Name"]
[1] "100307_3T_BIAS_BC.nii.gz"
&gt; scan_resources[1,"URI"]
[1] "/data/experiments/ConnectomeDB_E03657/scans/101/resources/69128/files/100307_3T_BIAS_BC.nii.gz"</code></pre>
<p>To download the resource file (100307_3T_BIAS_BC.nii.gz) we will do:</p>
<pre class="{r}"><code>&gt; download_xnat_file(hcp,"/data/experiments/ConnectomeDB_E03657/scans/101/resources/69128/files/100307_3T_BIAS_BC.nii.gz")
[1] "/var/folders/wb/l7jtkdy14f761vm4xr9zxjj80000gn/T//RtmpFfYbQ7/100307_3T_BIAS_BC.nii.gz"</code></pre>
</div>
<div id="getting-data-download-a-directory-of-data" class="section level2">
<h2 class="hasAnchor">
<a href="#getting-data-download-a-directory-of-data" class="anchor"></a>Getting Data: Download a directory of data</h2>
<p>To download all the T2w type images from experiment ConnectomeDB_E03657 we will use the <code>download_xnat_dir</code> function.</p>
<pre class="{r}"><code>download_xnat_dir(hcp, experiment_ID='ConnectomeDB_E03657',scan_type='T2w', verbose=TRUE)
Downloading: 28 MB     [1] "/var/folders/wb/l7jtkdy14f761vm4xr9zxjj80000gn/T//RtmpFfYbQ7/ConnectomeDB_E03657.zip"</code></pre>
<p>To retrieve just the nii.gz file we can use the <code>unzip</code> parameter.</p>
<pre class="{r}"><code>T2w_file &lt;- download_xnat_dir(hcp, experiment_ID='ConnectomeDB_E03657',scan_type='T2w', unzip=TRUE)
T2w_file 
[1] "/var/folders/wb/l7jtkdy14f761vm4xr9zxjj80000gn/T//RtmpqNhtes/100307_3T/scans/104-T2w/resources/NIFTI/files/100307_3T_T2w_SPC1.nii.gz"</code></pre>
</div>
</div>

  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <div class="links">
<h2>Links</h2>
<ul class="list-unstyled">
<li>Download from CRAN at <br><a href="https://cloud.r-project.org/package=Rxnat">https://​cloud.r-project.org/​package=Rxnat</a>
</li>
<li>Browse source code at <br><a href="https://github.com/adigherman/Rxnat/">https://​github.com/​adigherman/​Rxnat/​</a>
</li>
<li>Report a bug at <br><a href="https://github.com/adigherman/Rxnat/issues">https://​github.com/​adigherman/​Rxnat/​issues</a>
</li>
</ul>
</div>
<div class="license">
<h2>License</h2>
<ul class="list-unstyled">
<li><a href="https://www.r-project.org/Licenses/GPL-2">GPL-2</a></li>
</ul>
</div>
<div class="developers">
<h2>Developers</h2>
<ul class="list-unstyled">
<li>Adi Gherman <br><small class="roles"> Author, maintainer </small>  </li>
</ul>
</div>

  <div class="dev-status">
<h2>Dev status</h2>
<ul class="list-unstyled">
<li><a href="https://travis-ci.com/adigherman/Rxnat"><img src="https://travis-ci.com/adigherman/Rxnat.svg?branch=master" alt="Travis-CI Build Status"></a></li>
<li><a href="https://ci.appveyor.com/project/adigherman/rxnat"><img src="https://ci.appveyor.com/api/projects/status/lnfie5vmqoipp920?svg=true" alt="AppVeyor Build Status"></a></li>
<li><a href="https://coveralls.io/r/adigherman/Rxnat?branch=master"><img src="https://coveralls.io/repos/github/adigherman/Rxnat/badge.svg" alt="Coverage status"></a></li>
</ul>
</div>
</div>
</div>


      <footer><div class="copyright">
  <p>Developed by Adi Gherman.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.5.1.9000.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
